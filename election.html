<!DOCTYPE html>
<html lang="en">
<head>
    <title>Election - Vote Now</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: linear-gradient(135deg, #1e3c72, #2a5298); height: 100vh; display: flex; justify-content: center; align-items: center; margin:0; }
        .card { background: white; padding: 40px; border-radius: 20px; box-shadow: 0 20px 40px rgba(0,0,0,0.4); width: 350px; text-align: center; }
        .input-box { position: relative; margin: 15px 0; }
        input { width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; box-sizing: border-box; }
        .eye { position: absolute; right: 10px; top: 10px; cursor: pointer; color: #666; }
        button { width: 100%; padding: 15px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .btn-login { background: #1e3c72; color: white; }
        .btn-vote { background: #27ae60; color: white; transition: 0.3s; }
        .btn-vote:hover { transform: scale(1.05); background: #2ecc71; }
        .hidden { display: none; }
    </style>
</head>
<body>

    <div class="card" id="loginBox">
        <h2>Voter Login</h2>
        <div class="input-box">
            <input type="text" id="vID" placeholder="Voter ID">
        </div>
        <div class="input-box">
            <input type="password" id="vPW" placeholder="Password">
            <span class="eye" onclick="toggleVPass()">üëÅÔ∏è</span>
        </div>
        <button class="btn-login" onclick="login()">Enter Election</button>
    </div>

    <div class="card hidden" id="voteBox">
        <h2>Cast Your Vote</h2>
        <p>ID: <b id="userDisplay"></b></p>
        <div id="btnContainer"></div>
    </div>

    <script>
        function toggleVPass() {
            const p = document.getElementById('vPW');
            p.type = p.type === "password" ? "text" : "password";
        }

        function login() {
            const id = document.getElementById('vID').value;
            const pw = document.getElementById('vPW').value;
            const voters = JSON.parse(localStorage.getItem('voters')) || [];
            const voter = voters.find(v => v.id === id && v.pass === pw);

            if(!voter) return alert("Invalid credentials!");
            if(voter.hasVoted) return alert("You already voted!");

            document.getElementById('loginBox').classList.add('hidden');
            document.getElementById('voteBox').classList.remove('hidden');
            document.getElementById('userDisplay').innerText = id;
            loadCandidates(id);
        }

        function loadCandidates(voterId) {
            const container = document.getElementById('btnContainer');
            const cands = JSON.parse(localStorage.getItem('candidates')) || ["Candidate A", "Candidate B"];
            container.innerHTML = "";
            cands.forEach(c => {
                const b = document.createElement('button');
                b.className = "btn-vote";
                b.innerText = "Vote for " + c;
                b.onclick = () => cast(voterId, c);
                container.appendChild(b);
            });
        }

        function cast(voterId, name) {
            if(!confirm("Vote for " + name + "?")) return;
            
            let voters = JSON.parse(localStorage.getItem('voters'));
            let votes = JSON.parse(localStorage.getItem('votes')) || {};
            
            votes[name] = (votes[name] || 0) + 1;
            const vIdx = voters.findIndex(v => v.id === voterId);
            voters[vIdx].hasVoted = true;

            localStorage.setItem('voters', JSON.stringify(voters));
            localStorage.setItem('votes', JSON.stringify(votes));
            alert("Vote successful!");
            location.reload();
        }
    </script>
</body>
</html>